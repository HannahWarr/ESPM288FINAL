# Unit I: Climate Change Module

## Opening Tutorial: Examining CO2 trends in python

-   Example from <http://climate.nasa.gov/vital-signs/carbon-dioxide/>
-   Raw data from <https://gml.noaa.gov/webdata/ccgg/trends/co2/co2_mm_mlo.txt>

```{r}
library(ggplot2)
library(dplyr)
library(lubridate)
library(tidyverse)

```

```{r}
#read in data
columns = c('year', 'month', 'decimal_date', 'average', 'smooth', 'std_days', 'uncertainty', 'empty')
df = read.table("https://gml.noaa.gov/webdata/ccgg/trends/co2/co2_mm_mlo.txt", col.names =  columns)
df
```

```{r}
#plot the data
ggplot(df, aes(decimal_date, average)) +
  geom_line(color = "blue") +
  xlab("Year") +
  ylab("Average CO2")
  

```

```{r}
#averaging all the months

co2_tidy <- df %>%
  group_by(month) %>%
  summarize(average = mean(average, na.rm = TRUE)) 
co2_tidy

```

```{r}
# plot the averages on an average year

ggplot(co2_tidy, aes(month, average)) +
  geom_line(color = "steelblue") +
  labs(title = "Annual Average CO2",
       x = "Months",
       y = "CO2 (ppm)") +
  theme_minimal()
```

Which months are the CO2 values at the maximum? Minimum? Why is this?

-   Max is at April (early spring) and Min is near September (Fall) Maybe this is due to the fact that most vegetation is more active during summer, taking away lots of CO2 from atmosphere.

------------------------------------------------------------------------

# Exercise I: Temperature Data

Each of the last years has consecutively set new records on global climate. In this section we will analyze global mean temperature data.

Data from: <http://climate.nasa.gov/vital-signs/global-temperature>

## Question 1:

Describe the data set to the best of your ability given the documentation provided. Describe what kind of column each data contains and what units it is measured in. Then address our three key questions in understanding this data:

-   How are the measurements made? What is the associated measurement uncertainty?

-   What is the resolution of the data?

-   Are their missing values? How should they be handled?

```{r}
#The data is collected is global surface temperature compared to a long term average from 1951-1980

#Columns are 'Year' data was collected (discrete data), temp in C with 'No_smoothing', and a temp in C that is smoothed using 'Lowess' method

    # Measurements made a from GISS which seems to be using satellites and space probes
    # Data is collected to the hundredth of a C degree
    # to find missing values we need to ask with the code "sum(is.na(ice))", which we should then throw out any missing values
```

## Question 2:

Construct the necessary r code to import and prepare for manipulation the following data set: <http://climate.nasa.gov/system/internal_resources/details/original/647_Global_Temperature_Data_File.txt>

```{r}
#read in data
columns = c('Year', 'No_smoothing', 'Lowess')
df = read.table("https://data.giss.nasa.gov/gistemp/graphs/graph_data/Global_Mean_Estimates_based_on_Land_and_Ocean_Data/graph.txt", skip=5, col.names = columns)
df
```

```{r}
#checking for missing values
sum(is.na(df))
#and there is none so we don't need to worry about not including them in the data
```

## Question 3:

Plot the trend in global mean temperatures over time. Describe what you see in the plot and how you interpret the patterns you observe.

```{r}
#plotting the data

ggplot(df, aes(x = Year)) +
  geom_line(aes(y = No_smoothing, color = "No smoothing", linetype = "No smoothing")) +
  geom_line(aes(y = Lowess, color = "Lowess", linetype = "Lowess")) +
  labs(title = "Global Mean Temperature Anomaly",
       x = "Year",
       y = "Temperature Anomaly (°C)",
       color = "Line Type",
       linetype = "Line Type") +
  scale_color_manual(values = c("No smoothing" = "steelblue", "Lowess" = "darkred")) +
  scale_linetype_manual(values = c("No smoothing" = "dashed", "Lowess" = "solid")) +
  theme_minimal()
```

# Exercise II: Melting Ice Sheets?

-   Data description: <http://climate.nasa.gov/vital-signs/land-ice/>
-   Raw data file: <http://climate.nasa.gov/system/internal_resources/details/original/499_GRN_ANT_mass_changes.csv>

## Question 1:

-   Describe the data set: what are the columns and units? Where do the numbers come from?
-   What is the uncertainty in measurement? Resolution of the data? Interpretation of missing values?

```{r}

#    - There are three columns. First is year in decimal notation, second is the mass of ice in Greenland, and third is the mass of ice in Antarctica. Data is collected from NASA's GRACE satellites
#    - The units are gigatonnes. The data is from the GRACE satellite mission. The uncertainty is 10 gigatonnes (this information was filled in by AI and I cannot find the verification of it). 
#    - The resolution is two decimal places. No missing values, but I can find them using is.na()

```

## Question 2:

Construct the necessary code to import this data set.

```{r}
columns = c('decimal_date', 'greenland_mass', 'antarctica_mass')
ice = read.csv("http://climate.nasa.gov/system/internal_resources/details/original/499_GRN_ANT_mass_changes.csv", col.names= columns, skip=9)
ice

```

```{r}
#checking for missing values in file
sum(is.na(ice))

```

## Question 3:

Plot the data and describe the trends you observe.

```{r}
#plotting data
ggplot(ice, aes(x = decimal_date)) +
  geom_line(aes(y = greenland_mass, color = "Greenland", linetype = "Greenland")) +
  geom_line(aes(y = antarctica_mass, color = "Antarctica", linetype = "Antarctica")) +
  labs(title = "Ice masses over time",
       x = "Year",
       y = "Mass of Ice (Gt)",
       color = "Location",
       linetype = "Location") +
  scale_color_manual(values = c("Greenland" = "darkgreen", "Antarctica" = "darkblue")) +
  scale_linetype_manual(values = c("Greenland" = "solid", "Antarctica" = "solid")) +
  theme_minimal()
```
```{r}
#if i wanted to split graph into two panels

#mutate data 

ice_long <- ice %>%
  pivot_longer(cols = c(greenland_mass, antarctica_mass),
               names_to = "location",
               values_to = "mass") %>%
  mutate(location = recode(location,
                           greenland_mass = "Greenland",
                           antarctica_mass = "Antarctica"))

ggplot(ice_long, aes(x = decimal_date, y = mass, color = location)) +
  geom_line() +
  facet_wrap(~ location, nrow = 1) +  # Side-by-side panels
  scale_color_manual(values = c("Greenland" = "darkgreen", "Antarctica" = "darkblue")) +
  labs(title = "Ice Masses Over Time",
       x = "Year",
       y = "Mass of Ice (Gt)",
       color = "Location") +
  theme_minimal()

#this honestly feels like too much work, but valuable to have this plotting method in my repertoire
```

```{r}
#NOW I WANT TO MAKE A MAP OF ICE CAPS
```

# Exercise III: Rising Sea Levels?

-   Data description: <http://climate.nasa.gov/vital-signs/sea-level/>
-   Raw data file: <http://climate.nasa.gov/system/internal_resources/details/original/121_Global_Sea_Level_Data_File.txt>

## Question 1:

-   Describe the data set: what are the columns and units?
-   Where do these data come from?
-   What is the uncertainty in measurment? Resolution of the data? Interpretation of missing values?

```{r}
# Data is quantifying global sea level rise. There are twelve columns. The column names are listed in the headers. Of all the columns, the ones we will likely focus on are Year (given in continuous decimal date), and the last column which is smoothed GMSL GIA applied variation in mm with annual and semi-annual signal removed

#data comes from Global Mean sea level which is computed at NASa Goddard Space Flight Center which combines Sea Surface Heights from TOPEX/Poseidon, Jason-1 and OSTM/Jason-2

#data is collected in mm, with very little uncertainty. Missing values are listed by 99900.00
```


## Question 2:

Construct the necessary R code to import this data set as a tidy `Table` object.
```{r}
#read in data
columns = c('type', 'file', 'decimal_date', 'observations', 'weighted_observations', 'GMSL_TOPEX', 'std_GMSL_TOPEX', 'unknown', 'GMSL_TOPEX_GIA' , 'std_GMSL_TOPEX_GIA' ,'smoothed_GMSL', 'smoothed_GMSL_nosignal')
df = read.table("http://climate.nasa.gov/system/internal_resources/details/original/121_Global_Sea_Level_Data_File.txt", col.names = columns, skip = 47)
df <- df[df$type != 999, ]
df

```


## Question 3:

Plot the data and describe the trends you observe.

```{r}
ggplot(df, aes(x = decimal_date)) +
  geom_ribbon(aes(ymin= smoothed_GMSL_nosignal - 4 + 14.09, ymax = smoothed_GMSL_nosignal +4 + 14.09), fill ="lightblue")  + #website says 4.0 mm is uncertainty level
  geom_line(aes(y = smoothed_GMSL_nosignal + 14.09)) + #because this is since 1993 I need to subtract the original sea level (also done above)
  labs(title = "Sea Level Rise",
       x = "Year",
       y = "Sea Height Variation (mm)") +
  theme_minimal()

```


# Exercise IV: Arctic Sea Ice?

-   <http://nsidc.org/data/G02135>
-   <https://noaadata.apps.nsidc.org/NOAA/G02135/north/monthly/data/>

## Question 1:

-   Describe the data set: what are the columns and units?
-   Where do these data come from?
-   What is the uncertainty in measurement? Resolution of the data? Interpretation of missing values?

## Question 2:

Construct the necessary code to import this data set

``` python
url=["https://noaadata.apps.nsidc.org/NOAA/G02135/north/monthly/data/N_01_extent_v3.0.csv","https://noaadata.apps.nsidc.org/NOAA/G02135/north/monthly/data/N_02_extent_v3.0.csv"]
```

## Question 3:

Plot the data and describe the trends you observe.

``` python
arctic_ice = con.read_csv(url).execute()
arctic_ice
```



``` python
arctic_ice = arctic_ice[~(arctic_ice == -9999).any(axis=1)]
so.Plot(arctic_ice, x="area", y="year").add(so.Lines())
```

![png](climate_files/climate_39_0.png)

# Exercise V: Longer term trends in CO2 Records

The data we analyzed in the unit introduction included CO2 records dating back only as far as the measurements at the Manua Loa observatory. To put these values into geological perspective requires looking back much farther than humans have been monitoring atmosopheric CO2 levels. To do this, we need another approach.

[Ice core data](http://cdiac.ornl.gov/trends/co2/ice_core_co2.html):

Vostok Core, back to 400,000 yrs before present day

-   Description of data set: <http://cdiac.esd.ornl.gov/trends/co2/vostok.html>
-   Data source: <http://cdiac.ornl.gov/ftp/trends/co2/vostok.icecore.co2>

## Questions / Tasks:

-   Describe the data set: what are the columns and units? Where do the numbers come from?
-   What is the uncertainty in measurment? Resolution of the data? Interpretation of missing values?
-   Read in and prepare data for analysis.
-   Reverse the ordering to create a chronological record.\
-   Plot data
-   Consider various smoothing windowed averages of the data.
-   Join this series to Mauna Loa data
-   Plot joined data
-   Describe your conclusions

``` python
## Data set description
 # columns: Depth (m), Age of the ice (yr BP), Mean age of the air (yr BP), CO2 concentration (ppmv) and data comes from vostok ice core
 #
# data kinda difficult to collect so go to website
# https://data.ess-dive.lbl.gov/view/doi:10.3334/CDIAC/ATG.009
# had to download the data and store it 'locally' on the server bc website didnt work
    #I fear lines may have been skipped because the data seems to have several tabs
    # Check for missing values
missing_values = df.isnull().sum()
print(missing_values)
```

    date          0
    greenland     0
    antarctica    0
    dtype: int64

``` python
columns = ['Depth (m)', 'Age of the ice (yr BP)', 'Mean age of the air (yr BP)', 'CO2 concentration (ppmv)']
df = pd.read_csv('/home/jovyan/climate-teams-wasp-policy/vostok.icecore (3).co2', 
                   header=None, 
                   skiprows=21, 
                   names=columns, 
                   sep='\t')
df

print(df.iloc[115:125]) # Just checking that the data looks right with the extra tabs
```

         Depth (m)  Age of the ice (yr BP)  Mean age of the air (yr BP)  \
    115    2107.05                  154557                       149157   
    116    2116.00                  155625                       150303   
    117    2117.00                  155743                       150423   
    118    2131.10                  157456                       151854   
    119    2157.00                  160293                       154471   
    120    2164.00                  161077                       155299   
    121    2167.20                  161451                       155707   
    122    2203.00                  165646                       160494   
    123    2207.30                  166193                       161037   
    124    2225.00                  168391                       162996   

         CO2 concentration (ppmv)  
    115                     203.0  
    116                     191.9  
    117                     188.9  
    118                     200.6  
    119                     189.0  
    120                     185.5  
    121                     187.5  
    122                     204.4  
    123                     196.5  
    124                     191.6  

``` python
#Now to reverse the order of the data so its in chronological order

columns = ['Depth (m)', 'Age of the ice (yr BP)', 'Mean age of the air (yr BP)', 'CO2 concentration (ppmv)']
df = pd.read_csv('/home/jovyan/climate-teams-wasp-policy/vostok.icecore (3).co2', 
                   header=None, 
                   skiprows=21, 
                   names=columns, 
                   sep='\t')
df_reversed = df.iloc[::-1] #this should reverse the order of the data
print(df_reversed)
```

         Depth (m)  Age of the ice (yr BP)  Mean age of the air (yr BP)  \
    362    3304.40                  419328                       417160   
    361    3301.40                  417638                       415434   
    360    3299.01                  416332                       414085   
    359    3292.91                  413010                       410831   
    358    3289.45                  411202                       409022   
    ..         ...                     ...                          ...   
    4       250.30                   10579                         7327   
    3       228.60                    9523                         6220   
    2       177.40                    7043                         3833   
    1       173.10                    6828                         3634   
    0       149.10                    5679                         2342   

         CO2 concentration (ppmv)  
    362                     277.6  
    361                     286.9  
    360                     285.5  
    359                     276.3  
    358                     283.7  
    ..                        ...  
    4                       254.6  
    3                       262.2  
    2                       268.1  
    1                       272.8  
    0                       284.7  

    [363 rows x 4 columns]

``` python
#Now to plot the data
columns = ['Depth (m)', 'Age of the ice (yr BP)', 'Mean age of the air (yr BP)', 'CO2 concentration (ppmv)']
df = pd.read_csv('/home/jovyan/climate-teams-wasp-policy/vostok.icecore (3).co2', 
                   header=None, 
                   skiprows=21, 
                   names=columns, 
                   sep='\t')
df_reversed = df.iloc[::-1] #this should reverse the order of the data
so.Plot(df_reversed, x="Mean age of the air (yr BP)", y="CO2 concentration (ppmv)").add(so.Lines())
```

![png](climate_files/climate_44_0.png)

``` python
columns = ['Depth (m)', 'Age of the ice (yr BP)', 'Mean age of the air (yr BP)', 'CO2 concentration (ppmv)']
df = pd.read_csv('/home/jovyan/climate-teams-wasp-policy/vostok.icecore (3).co2', 
                   header=None, 
                   skiprows=21, 
                   names=columns, 
                   sep='\t')
df_reversed = df.iloc[::-1] #this should reverse the order of the data
#I am going to simply the data so maybe it will combine easier later on 
new_df2 = df_reversed[['Mean age of the air (yr BP)', 'CO2 concentration (ppmv)']]
new_df2
```

<div>

```{=html}
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
```
|      | Mean age of the air (yr BP) | CO2 concentration (ppmv) |
|------|-----------------------------|--------------------------|
| 362  | 417160                      | 277.6                    |
| 361  | 415434                      | 286.9                    |
| 360  | 414085                      | 285.5                    |
| 359  | 410831                      | 276.3                    |
| 358  | 409022                      | 283.7                    |
| \... | \...                        | \...                     |
| 4    | 7327                        | 254.6                    |
| 3    | 6220                        | 262.2                    |
| 2    | 3833                        | 268.1                    |
| 1    | 3634                        | 272.8                    |
| 0    | 2342                        | 284.7                    |

<p>363 rows × 2 columns</p>

</div>

``` python
#time to combine this with the Muana Loa data

columns = ['year', 'month', 'decimal_date', 'average', 'smooth', 'std_days', 'uncertainty', 'empty']
df = pd.read_csv("https://gml.noaa.gov/webdata/ccgg/trends/co2/co2_mm_mlo.txt", sep="\s+", comment="#", names= columns)
df
#now I need year to change to 'years old'
columns = ['year', 'month', 'decimal_date', 'average', 'smooth', 'std_days', 'uncertainty', 'empty']
df = pd.read_csv("https://gml.noaa.gov/webdata/ccgg/trends/co2/co2_mm_mlo.txt", sep="\s+", comment="#", names=columns)

# Perform the arithmetic operation
def_age['age'] = 2025.5 - df['decimal_date']

# Print the first few rows of the updated new DataFrame
print(def_age.head())
```

       year  month  decimal_date  average  smooth  std_days  uncertainty  empty  \
    0  1958      3     1958.2027   315.71  314.44        -1        -9.99  -0.99   
    1  1958      4     1958.2877   317.45  315.16        -1        -9.99  -0.99   
    2  1958      5     1958.3699   317.51  314.69        -1        -9.99  -0.99   
    3  1958      6     1958.4548   317.27  315.15        -1        -9.99  -0.99   
    4  1958      7     1958.5370   315.87  315.20        -1        -9.99  -0.99   

           age  
    0  67.2973  
    1  67.2123  
    2  67.1301  
    3  67.0452  
    4  66.9630  

``` python
#unsure if this is necessary but I am simplying the amount of data from Mauna Loa
columns = ['year', 'month', 'decimal_date', 'average', 'smooth', 'std_days', 'uncertainty', 'empty']
df = pd.read_csv("https://gml.noaa.gov/webdata/ccgg/trends/co2/co2_mm_mlo.txt", sep="\s+", comment="#", names=columns)

# Perform the arithmetic operation
def_age['age'] = 2025.5 - df['decimal_date']
new_df1 = def_age[['average', 'age']]
new_df1
```

<div>

```{=html}
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
```
|      | average | age     |
|------|---------|---------|
| 0    | 315.71  | 67.2973 |
| 1    | 317.45  | 67.2123 |
| 2    | 317.51  | 67.1301 |
| 3    | 317.27  | 67.0452 |
| 4    | 315.87  | 66.9630 |
| \... | \...    | \...    |
| 798  | 422.03  | 0.7917  |
| 799  | 422.38  | 0.7083  |
| 800  | 423.85  | 0.6250  |
| 801  | 425.40  | 0.5417  |
| 802  | 426.65  | 0.4583  |

<p>803 rows × 2 columns</p>

</div>

``` python
#I am going to try to combine the data now (wish me luck)

columns = ['Depth (m)', 'Age of the ice (yr BP)', 'Mean age of the air (yr BP)', 'CO2 concentration (ppmv)']
df = pd.read_csv('/home/jovyan/climate-teams-wasp-policy/vostok.icecore (3).co2', 
                   header=None, 
                   skiprows=21, 
                   names=columns, 
                   sep='\t')
df_reversed = df.iloc[::-1] #this should reverse the order of the data
print(df_reversed)
#I am going to simply the data so maybe it will combine easier later on 
new_df2 = df_reversed[['Mean age of the air (yr BP)', 'CO2 concentration (ppmv)']]

#now I need year to change to 'years old'
columns2 = ['year', 'month', 'decimal_date', 'average', 'smooth', 'std_days', 'uncertainty', 'empty']
df = pd.read_csv("https://gml.noaa.gov/webdata/ccgg/trends/co2/co2_mm_mlo.txt", sep="\s+", comment="#", names=columns2)

# Perform the arithmetic operation
def_age['age'] = 2025.5 - df['decimal_date']

new_df1 = def_age[['average', 'age']]

#I think first I need to rename the columns so they fit together
column_mapping = {
    'average': 'CO2 concentration (ppmv)',
    'age': 'Mean age of the air (yr BP)'
}
# Rename the columns in the new_df1 and new_df2 DataFrames
new_df1_renamed = new_df1.rename(columns=column_mapping)
new_df2_renamed = new_df2.rename(columns=column_mapping)
# Combine (the ai says concatenate) the DataFrames
df_concat = pd.concat([new_df1_renamed, new_df2_renamed])

# Print the resulting data table
print(df_concat)

#I mean that looks like it worked (YAY?!) Now to plot the data which I will probably have to flip it and reverse it :/
    #Maybe I should instead make the core data negative?
```

         Depth (m)  Age of the ice (yr BP)  Mean age of the air (yr BP)  \
    362    3304.40                  419328                       417160   
    361    3301.40                  417638                       415434   
    360    3299.01                  416332                       414085   
    359    3292.91                  413010                       410831   
    358    3289.45                  411202                       409022   
    ..         ...                     ...                          ...   
    4       250.30                   10579                         7327   
    3       228.60                    9523                         6220   
    2       177.40                    7043                         3833   
    1       173.10                    6828                         3634   
    0       149.10                    5679                         2342   

         CO2 concentration (ppmv)  
    362                     277.6  
    361                     286.9  
    360                     285.5  
    359                     276.3  
    358                     283.7  
    ..                        ...  
    4                       254.6  
    3                       262.2  
    2                       268.1  
    1                       272.8  
    0                       284.7  

    [363 rows x 4 columns]
        CO2 concentration (ppmv)  Mean age of the air (yr BP)
    0                     315.71                      67.2973
    1                     317.45                      67.2123
    2                     317.51                      67.1301
    3                     317.27                      67.0452
    4                     315.87                      66.9630
    ..                       ...                          ...
    4                     254.60                    7327.0000
    3                     262.20                    6220.0000
    2                     268.10                    3833.0000
    1                     272.80                    3634.0000
    0                     284.70                    2342.0000

    [1166 rows x 2 columns]

``` python
```
